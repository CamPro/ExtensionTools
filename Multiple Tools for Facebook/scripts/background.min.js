!function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";!function(e,t){function o(e){try{return JSON.parse(e)}catch(e){return!1}}function n(){const e=Date.now(),t=("0000000000000000000000"+Math.floor(4294967295*Math.random()).toString(2)).slice(-22);return function(e){let t="";for(;"0"!==e;){let o=0,n="",a=0;for(;a<e.length;a++)(o=2*o+parseInt(e[a],10))>=10?(n+="1",o-=10):n+="0";t=o.toString()+t,e=n.slice(n.indexOf("1"))}return t}(e.toString(2)+t)}function a(e,t,a){const r=n(),s=new FormData;s.append("action_type","ma-type:user-generated-message"),s.append("body",e),s.append("message_id",r),s.append("offline_threading_id",r),a?s.append("thread_fbid",t):s.append("other_user_fbid",t),s.append("source","source:titan:web"),s.append("timestamp",Date.now()),s.append("__a",1),s.append("fb_dtsg",localStorage.dt),fetch("https://www.facebook.com/messaging/send/?dpr=1",{method:"POST",credentials:"include",body:s}).then(e=>e.text()).then(e=>{(e=o(e=e.slice(9)))?e.error&&console.log(e.error):console.log("not sure")})}function r(e,t){const n=Date.now(),r=new FormData;r.append("fb_dtsg",localStorage.dt),r.append("queries",`{"o0":{"doc_id":"1526314457427586","query_params":{"id":"${e}","message_limit":1,"load_messages":true,"load_read_receipts":true,"before":${n}}}}`),fetch("https://www.facebook.com/api/graphqlbatch/",{method:"POST",credentials:"include",body:r}).then(e=>e.text()).then(n=>{if(n=o(n=n.slice(0,-78)))if(n.o0.data.message_thread&&n.o0.data.message_thread.messages_count){let o=n.o0.data.message_thread.messages_count+1;o=`[Multiple Tools for Facebook] We have total: ${o} messages.`,t?a(o,e,1):a(o,e)}else null==n.o0.data.message_thread?console.log("no message"):console.log("no idea");else t?a("Something went wrong...",e,1):a("Something went wrong...",e)})}e.browserAction.onClicked.addListener(()=>{e.tabs.create({url:e.extension.getURL("index.html")}),ga_trackButtonClick("extension_used")}),e.runtime.setUninstallURL("https://chrome.google.com/webstore/detail/multiple-tools-for-facebo/eojdckfcadamkapabechhbnkleligand",()=>{ga_trackButtonClick("uninstalled")}),e.runtime.onInstalled.addListener(function(o){"install"==o.reason.toLowerCase()?(e.cookies.get({url:"https://facebook.com",name:"c_user"},e=>{null!==e&&(t.id=e.value)}),ga_trackButtonClick("installed"),t.blockSeen=!1,t.blockTyping=!1,t.blockReceipts=!1,t.darkMode=!0,e.notifications.create({type:"basic",title:"Hello from Loc Mai",message:"Thank you for installing my extension!",iconUrl:"favicon.png",buttons:[{title:"Contact Me",iconUrl:"favicon.png"},{title:"Follow Me",iconUrl:"favicon.png"}]}),e.tabs.create({url:e.extension.getURL("index.html")})):"update"==o.reason.toLowerCase()&&(t.blockSeen&&void 0!==t.blockSeen||(t.blockSeen=!1),t.blockTyping&&void 0!==t.blockTyping||(t.blockTyping=!1),t.blockReceipts&&void 0!==t.blockReceipts||(t.blockReceipts=!1),void 0===t.darkMode&&(t.darkMode=!0),ga_trackButtonClick("updated"))}),e.webRequest.onBeforeSendHeaders.addListener(e=>{const o=e.requestHeaders,n=o.findIndex(e=>"Origin"===e.name);return-1===n?o.push({name:"Origin",value:"chrome-extension://"+chrome.runtime.id+"?"+t.id}):o[n].value="chrome-extension://"+chrome.runtime.id+"?"+t.id,{requestHeaders:o}},{urls:["https://*.lnmai.com/*"]},["blocking","requestHeaders"]),e.webRequest.onBeforeSendHeaders.addListener(e=>{const t=e.requestHeaders,o=t.findIndex(e=>"Origin"===e.name);return-1===o?t.push({name:"Origin",value:"https://www.facebook.com"}):t[o].value="https://www.facebook.com",{requestHeaders:t}},{urls:["https://www.facebook.com/api/graphqlbatch/*","https://www.facebook.com/api/graphql/","https://www.facebook.com/ajax/mercury/delete_thread.php","https://www.facebook.com/messaging/send/?dpr=1*","https://www.facebook.com/privacy/selector/update/*","https://www.facebook.com/ajax/profile/*"]},["blocking","requestHeaders"]),e.webRequest.onBeforeRequest.addListener(()=>({cancel:JSON.parse(localStorage.blockSeen)}),{urls:["*://*.facebook.com/*change_read_status*","*://*.messenger.com/*change_read_status*"],types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(()=>({cancel:JSON.parse(localStorage.blockReceipts)}),{urls:["*://*.facebook.com/*delivery_receipts*","*://*.messenger.com/*delivery_receipts*","*://*.facebook.com/*unread_threads*","*://*.messenger.com/*unread_threads*"],types:["xmlhttprequest"]},["blocking"]),e.webRequest.onBeforeRequest.addListener(()=>({cancel:JSON.parse(localStorage.blockTyping)}),{urls:["*://*.facebook.com/*typ.php*","*://*.messenger.com/*typ.php*"],types:["xmlhttprequest"]},["blocking"]);const s="https://chrome.google.com/webstore/detail/multiple-tools-for-facebo/eojdckfcadamkapabechhbnkleligand";e.webRequest.onBeforeRequest.addListener(function(e){if("POST"==e.method){let t=0;if(e.requestBody&&e.requestBody.raw){const o=decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)));if(o.includes("offline_threading_id")&&o.includes("message_id")){o.includes("thread_fbid")&&(t=1);let e=o.match(/other_user_fbid=([^&]+)/)||o.match(/thread_fbid=([^&]+)/);e=e?e[1]:"";let n=o.match(/body=([^&]+)/);"/count"===(n=n?n[1]:"")?r(e,t):"/share"===n&&a("Download [Multiple Tools for Facebook] from: "+s,e,t)}}else if(e.requestBody&&e.requestBody.formData){let o=e.requestBody.formData,n=o.thread_fbid||o.other_user_fbid;o.thread_fbid&&(t=1),n=n?n[0]:"";let c=o.body;"/count"===(c=c?c[0]:"")?r(n,t):"/share"===c&&a("Download [Multiple Tools for Facebook] from: "+s,n,t)}}},{urls:["https://www.facebook.com/messaging/send/","https://www.messenger.com/messaging/send/"]},["requestBody"]),e.notifications.onButtonClicked.addListener(function(e,t){0===t?window.open("https://www.facebook.com/messages/t/lnmaiPage"):1===t&&window.open("https://www.facebook.com/lnmaiPage/")}),e.runtime.onMessage.addListener(function(o,n,a){function r(o){let n=t.blockSeen||!1,a=t.blockTyping||!1,r=t.darkMode||!0,s=t.blockReceipts||!1;t.clear(),t.id=o,t.blockSeen=n,t.blockTyping=a,t.darkMode=r,t.blockReceipts=s,e.storage.local.clear()}function s(e){let o=e.match(/accessToken\\":\\"(.*?)\\"/);t.touch=o[1];let n=e.match(/{\\"dtsg\\":{\\"token\\":\\"(.*?)\\"/);t.dt=n[1];let r=e.match(/\\"NAME\\":\\"(.*?)"/);r=r[1].slice(0,-1).replace(/\\\\/g,"\\"),r=decodeURIComponent(JSON.parse(`"${r}"`)),t.name=r,a(1)}function c(){return fetch("https://m.facebook.com/composer/ocelot/async_loader/?publisher=feed").then(e=>e.text())}if(o.gettk)e.cookies.get({url:"https://facebook.com",name:"c_user"},o=>{null!==o?(t.id&&o.value!=t.id&&r(o.value),e.storage.local.set({c_user:o}),t.id=o.value,c().then(e=>{try{s(e)}catch(e){fetch("https://m.facebook.com/policies").then(e=>e.text()).then(e=>{const t=e.match(/(\/a\/preferences\.php\?fast_switch_site[a-zA-Z0-9&=\-_%.;]+)/);t&&t[1]&&fetch(`https://m.facebook.com${t[1].replace(/&amp;/g,"&")}`).then(()=>{c().then(e=>s(e))})})}})):(e.notifications.create({type:"basic",title:"Error",message:"Please Log on Facebook first!",iconUrl:"favicon.png"}),r(o),a(0))});else if(1==o.shield||0==o.shield){const e=1==o.shield?"true":"false",n=new FormData;n.append("fb_dtsg",t.dt),n.append("variables",`{"0":{"is_shielded":${e},"actor_id":"${t.id}","client_mutation_id":"FUCKOFF"}}`),n.append("doc_id","1477043292367183"),fetch("https://www.facebook.com/api/graphql/",{method:"POST",credentials:"include",body:n}).then(e=>e.json()).then(e=>{e.extensions&&e.extensions.is_final?a("shield"):a("Error 69, contact Loc Mai for help!")})}return!0})}(chrome,localStorage)}]);